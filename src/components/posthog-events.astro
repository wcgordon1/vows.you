---
// src/components/posthog-events.astro
// Global delegated click handler for PostHog custom events
// Usage: Add data-ph-event="event_name" to any element
// Optional: Add data-ph-prop-{key}="value" for event properties
---

<script is:inline>
  document.addEventListener('click', function(e) {
    // Find the closest element with data-ph-event attribute
    const target = e.target.closest('[data-ph-event]');
    if (!target || typeof window.posthog === 'undefined') return;

    const eventName = target.dataset.phEvent;
    if (!eventName) return;

    // Collect all data-ph-prop-* attributes as properties
    const props = {};
    for (const [key, value] of Object.entries(target.dataset)) {
      if (key.startsWith('phProp')) {
        // Convert phPropPlanName to plan_name
        const propKey = key
          .replace('phProp', '')
          .replace(/([A-Z])/g, '_$1')
          .toLowerCase()
          .replace(/^_/, '');
        props[propKey] = value;
      }
    }

    // Capture the event
    window.posthog.capture(eventName, Object.keys(props).length > 0 ? props : undefined);
  });
</script>
