---
import BaseLayout from "@/layouts/BaseLayout.astro";
import Text from "@/components/fundations/elements/Text.astro";
import Wrapper from "@/components/fundations/containers/Wrapper.astro";
import JsonLd from "@/components/fundations/head/JsonLd.astro";
import ChevronRight from "@/components/fundations/icons/ChevronRight.astro";
import QuickVerdict from "@/components/compare/QuickVerdict.astro";
import QuickQA from "@/components/compare/QuickQA.astro";
import TOC from "@/components/compare/TOC.astro";
import FinalVerdict from "@/components/compare/FinalVerdict.astro";
import Faq from "@/components/compare/Faq.astro";
import {
  buildArticleSchema,
  buildBreadcrumbSchema,
  buildFaqSchema,
} from "@/lib/schema";

interface Props {
  frontmatter: {
    competitor: string;
    competitorUrl: string;
    competitorType: string;
    pageTitle: string;
    metaDescription: string;
    publishedDate: string;
    modifiedDate: string;
    quickVerdict: {
      summary: string;
      bestForCompetitor: string;
      bestForVowsYou: string;
    };
    qaItems: { q: string; a: string }[];
    competitorStrengths: string[];
    competitorDrawbacks: string[];
    priceNote: string;
    pickCompetitor: string[];
    pickVowsYou: string[];
    faqItems: { q: string; a: string }[];
  };
  slug: string;
}

const { frontmatter, slug } = Astro.props;

const SITE_URL = "https://vows.you";
const pageUrl = `${SITE_URL}/compare/${slug}`;

const articleSchema = buildArticleSchema({
  url: pageUrl,
  headline: frontmatter.pageTitle,
  description: frontmatter.metaDescription,
  datePublished: frontmatter.publishedDate,
  dateModified: frontmatter.modifiedDate,
});

const breadcrumbSchema = buildBreadcrumbSchema({
  url: pageUrl,
  competitorName: frontmatter.competitor,
});

const faqSchema = buildFaqSchema(frontmatter.faqItems);

const breadcrumbs = [
  { label: "Home", href: "/" },
  { label: "Compare", href: "/compare" },
  { label: frontmatter.competitor, href: "#" },
];
---

<BaseLayout
  title={frontmatter.pageTitle}
  description={frontmatter.metaDescription}
  ogType="article"
>
  <JsonLd slot="head" data={articleSchema} />
  <JsonLd slot="head" data={breadcrumbSchema} />
  <JsonLd slot="head" data={faqSchema} />

  <section>
    <Wrapper variant="standard" class="pt-32 pb-4">
      <div class="max-w-xl mx-auto">
        <nav
          aria-label="Breadcrumb"
          class="bg-sand-100 p-1.5 rounded-full px-6 w-fit"
        >
          <ol class="flex items-center text-xs gap-2 text-base-500">
            {
              breadcrumbs.map((item, index) => (
                <>
                  <li>
                    {index < breadcrumbs.length - 1 ? (
                      <a
                        href={item.href}
                        class="text-xs font-medium hover:text-accent-500 text-base-800"
                      >
                        {item.label}
                      </a>
                    ) : (
                      <span class="text-xs font-medium text-accent-500">
                        {item.label}
                      </span>
                    )}
                  </li>
                  {index < breadcrumbs.length - 1 && (
                    <li class="text-base-400">
                      <ChevronRight size="sm" />
                    </li>
                  )}
                </>
              ))
            }
          </ol>
        </nav>

        <Text
          tag="h1"
          variant="displaySM"
          class="mt-8 font-serif font-medium tracking-tight text-base-900"
        >
          Vows.you vs {frontmatter.competitor}
        </Text>
        <Text tag="p" variant="textBase" class="mt-4 text-base-500">
          {frontmatter.metaDescription}
        </Text>

        <QuickVerdict
          competitorName={frontmatter.competitor}
          competitorUrl={frontmatter.competitorUrl}
          summary={frontmatter.quickVerdict.summary}
          bestForCompetitor={frontmatter.quickVerdict.bestForCompetitor}
          bestForVowsYou={frontmatter.quickVerdict.bestForVowsYou}
        />

        <QuickQA items={frontmatter.qaItems} />

        <TOC competitorName={frontmatter.competitor} />
      </div>
    </Wrapper>

    <Wrapper variant="standard" class="py-4 border-t border-base-200 border-dashed">
      <div class="max-w-xl mx-auto">
        <Wrapper variant="prose">
          <slot />
        </Wrapper>

        <FinalVerdict
          competitorName={frontmatter.competitor}
          pickCompetitor={frontmatter.pickCompetitor}
          pickVowsYou={frontmatter.pickVowsYou}
        />

        <div class="mt-12">
          <Faq
            items={frontmatter.faqItems}
            competitorName={frontmatter.competitor}
          />
        </div>
      </div>
    </Wrapper>
  </section>
</BaseLayout>
